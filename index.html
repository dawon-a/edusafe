<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>êµìœ¡ì‹œì„¤ ì•ˆì „ì„±í‰ê°€ ëŒ€ìƒ í™•ì¸</title>

<style>
  /* =========================
     1. CSS ë³€ìˆ˜ & ê¸°ë³¸ ì„¤ì •
  ========================== */
  :root{
    --brand:#133e8d;
    --ink:#222;
    --muted:#6b7280;
    --card:#fff;
    --btn:#0f3a8a;
    --btn-t:#fff;
    --ok:#1e7b1e;
    --bad:#f59e0b;
    --soft-ok:#e8f5e9;
    --soft-bad:#fff7ed;
    --shadow:0 8px 24px rgba(0,0,0,.08);
    --err:#d92d20;
    --err-bg:#fee4e2;
  }

  *{box-sizing:border-box;}

  body{
    margin:0;
    background:#dfe8f5;
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR","Apple SD Gothic Neo","ë§‘ì€ ê³ ë”•",sans-serif;
    color:var(--ink);
  }

  .visually-hidden{
    position:absolute;
    width:1px;
    height:1px;
    padding:0;
    margin:-1px;
    overflow:hidden;
    clip:rect(0,0,0,0);
    white-space:nowrap;
    border:0;
  }

  /* =========================
     2. ë ˆì´ì•„ì›ƒ
  ========================== */
  .appbar{
    background:var(--brand);
    color:#fff;
    padding:14px 20px;
    position:sticky;
    top:0;
    z-index:100;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .title-wrap{
    /* position:relative;  â† ì œê±°í•´ì„œ appbar ê¸°ì¤€ìœ¼ë¡œ hits ìœ„ì¹˜ ì§€ì • */
    display:flex;
    flex-direction:column;
    align-items:center;
  }

  /* ì œëª© + ë¡œê³ ë¥¼ í•œ ì¤„ë¡œ ë¬¶ëŠ” ë˜í¼ */
  .title-main{
    display:flex;
    align-items:center;
    gap:8px;
  }

  .title{
    font-weight:800;
    font-size:28px;
    letter-spacing:-.5px;
    text-align:center;
  }

  /* í—¤ë” ë¡œê³  (PC ê¸°ë³¸ í¬ê¸°) */
  .title-logo{
    height:30px;
    width:auto;
  }

  .wrap{
    max-width:980px;
    margin:24px auto;
    padding:0 16px;
    position:relative;
  }

  .card{
    background:var(--card);
    border-radius:16px;
    box-shadow:var(--shadow);
    padding:18px;
  }

  .row{
    display:grid;
    grid-template-columns:150px 1fr;
    gap:14px;
    align-items:center;
    margin:10px 0;
  }

  /* =========================
     3. í¼ ìš”ì†Œ & ì—ëŸ¬ í‘œì‹œ
  ========================== */
  .label{
    font-weight:700;
  }

  .req{
    color:#dc2626;
    margin-left:2px;
  }

  .hint{
    color:var(--muted);
    font-size:12px;
  }

  .field{
    display:flex;
    gap:8px;
    align-items:flex-start;
    flex-wrap:wrap;
  }

  input,select{
    width:100%;
    max-width:260px;
    padding:10px 12px;
    border:1px solid #c7d2fe;
    border-radius:8px;
    background:#f8fbff;
    font-size:16px;
    outline:none;
  }

  input:focus,
  select:focus{
    box-shadow:0 0 0 3px rgba(19,62,141,.15);
  }

  .radio{
    display:flex;
    gap:16px;
  }

  .btn{
    background:var(--btn);
    color:var(--btn-t);
    border:0;
    padding:12px 18px;
    border-radius:10px;
    font-weight:800;
    cursor:pointer;
  }

  .btn:active{
    transform:translateY(1px);
  }

  .notice{
    margin-top:10px;
    background:#fff7ed;
    color:#92400e;
    border-left:5px solid #f59e0b;
    padding:10px 12px;
    border-radius:10px;
    font-weight:600;
    text-align:center;
  }

  .err{
    display:none;
    font-size:12px;
    color:var(--err);
    background:var(--err-bg);
    padding:6px 8px;
    border-radius:8px;
    margin-top:4px;
  }

  .has-error input,
  .has-error select{
    border-color:var(--err);
  }

  /* =========================
     4. ê²°ê³¼ ë°•ìŠ¤
  ========================== */
  .resultbox{
    display:none;
    margin-top:14px;
    border-left:6px solid var(--ok);
    border-radius:12px;
    padding:14px;
    background:var(--soft-ok);
  }

  .resultbox.bad{
    background:var(--soft-bad);
    border-left-color:var(--bad);
  }

  .result-title{
    font-weight:800;
    margin-bottom:6px;
    display:flex;
    gap:8px;
    align-items:center;
  }

  .result-title.hidden{
    display:none;
  }

  .ico{
    font-size:18px;
  }

  .guide{
    margin-top:10px;
    padding:10px 12px;
    border-radius:10px;
    background:#f1f5ff;
    color:#1f3b74;
    font-size:14px;
  }

  .guide a{
    color:#0f3a8a;
    font-weight:700;
    text-decoration:none;
    border-bottom:1px solid currentColor;
    margin-right:8px;
    display:inline-block;
    margin-top:4px;
  }

  /* =========================
     5. ê´‘ê³  ë°°ë„ˆ
  ========================== */
  .ad{
    position:fixed;
    right:16px;
    top:80px;
    z-index:9999;
    text-align:right;
  }

  .ad .unit{
    display:inline-block;
    background:#fff;
    border-radius:14px;
    box-shadow:var(--shadow);
    padding:10px;
  }

  .ad img{
    height:50px;
    vertical-align:middle;
  }

  .ad p{
    margin:6px 0 0 0;
    font-size:12px;
    color:#4b5563;
  }

  /* =========================
     6. hits.sh ë°°ì§€
  ========================== */
  .hit-badge{
    position:absolute;  /* appbar ê¸°ì¤€ ì˜¤ë¥¸ìª½ ê³ ì • */
    right:20px;
    top:50%;
    transform:translateY(-50%);
    display:flex;
    align-items:center;
  }

  .hit-badge img{
    display:block;
    height:22px;
    border-radius:999px;
    box-shadow:0 2px 6px rgba(0,0,0,.25);
  }

  /* =========================
     7. ë°˜ì‘í˜• (ëª¨ë°”ì¼)
  ========================== */
  @media (max-width:640px){
    .row{
      grid-template-columns:1fr;
    }

    .ad{
      position:static;
      margin-bottom:8px;
      text-align:center;
    }

    .ad .unit{
      width:100%;
    }

    /* ê²°ê³¼ì°½: í•˜ë‹¨ íŒ¨ë„ì²˜ëŸ¼ ë³´ì´ë„ë¡ */
    #result{
      position:fixed;
      left:0;
      right:0;
      bottom:0;
      margin:0;
      border-radius:16px 16px 0 0;
      max-height:50vh;
      overflow:auto;
      z-index:500;
    }

    /* hits ë°°ì§€: ì œëª© ì•„ë˜ë¡œ ì´ë™ + í¬ê¸° ì¶•ì†Œ */
    .hit-badge{
      position:static;
      transform:none;
      margin-top:6px;
      justify-content:center;
    }

    .hit-badge img{
      height:16px;
      box-shadow:0 1px 4px rgba(0,0,0,.2);
    }

    /* ëª¨ë°”ì¼ì—ì„œ í—¤ë” ë¡œê³  ì‚´ì§ ì¶•ì†Œ */
    .title-logo{
      height:24px;
    }
  }
</style>
</head>

<body>
<header class="appbar" role="banner">
  <div class="title-wrap">
    <!-- ì œëª© + ë¡œê³  í•œ ì¤„ -->
    <div class="title-main">
      <span class="title">êµìœ¡ì‹œì„¤ ì•ˆì „ì„±í‰ê°€ ëŒ€ìƒ í™•ì¸</span>
      <img src="header-logo.png" alt="ì„œë¹„ìŠ¤ ë¡œê³ " class="title-logo">
    </div>
  </div>
  <!-- hits.sh ë°°ì§€: í—¤ë” ìš°ì¸¡ì— ê³ ì • -->
  <div class="hit-badge">
    <a href="https://hits.sh/dawon-a.github.io/edusafe/">
      <img alt="Hits" src="https://hits.sh/dawon-a.github.io/edusafe.svg?color=effaff&labelColor=0073c6">
    </a>
  </div>
</header>

<main class="wrap" role="main">
  <!-- ê´‘ê³ : ìŠ¤í¬ë¡¤ ë”°ë¼ì˜¤ëŠ” ë°°ë„ˆ -->
  <aside class="ad" aria-label="ìŠ¤í°ì„œ">
    <a class="unit" href="http://dawonsafety.com/board/board_view?code=estimate&no=16" target="_blank" rel="noopener">
      <img src="dawon-logo.png" alt="ë‹¤ì›ì•ˆì „">
      <p class="muted">ê²¬ì  ë°”ë¡œê°€ê¸°</p>
    </a>
  </aside>

  <!-- ì…ë ¥ ì¹´ë“œ -->
  <section class="card" aria-labelledby="formTitle">
    <h2 id="formTitle" class="visually-hidden">ì…ë ¥</h2>

    <!-- ìœ„ì¹˜ êµ¬ë¶„ -->
    <div class="row" id="rowScope">
      <div class="label">ìœ„ì¹˜ êµ¬ë¶„<span class="req">*</span></div>
      <div>
        <div class="radio" role="radiogroup">
          <label><input type="radio" name="scope" value="êµë‚´"> êµë‚´</label>
          <label><input type="radio" name="scope" value="êµì™¸"> êµì™¸</label>
        </div>
        <div class="err" id="errScope" aria-live="polite">ìœ„ì¹˜êµ¬ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
      </div>
    </div>

    <!-- ì´ê²©ê±°ë¦¬ -->
    <div class="row" id="rowW23">
      <div class="label">í•™êµê²½ê³„ ì´ê²©ê±°ë¦¬(m)<span class="req">*</span></div>
      <div>
        <div class="field">
          <input id="w23" type="number" placeholder="ì˜ˆ: 12" inputmode="decimal" aria-describedby="w23Help">
        </div>
        <div id="w23Help" class="hint">ì˜ˆ: í•™êµ ê²½ê³„ì„ (ë‹´ì¥ ë“±)ì—ì„œ ê³µì‚¬ì¥ ê²½ê³„ê¹Œì§€ì˜ ì§ì„ ê±°ë¦¬(m)</div>
        <div class="err" id="errW23" aria-live="polite">ì´ê²©ê±°ë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</div>
      </div>
    </div>

    <!-- ì˜í–¥ê±°ë¦¬ -->
    <div class="row">
      <div class="label">ì˜í–¥ê±°ë¦¬(m)</div>
      <div>
        <div class="field">
          <input id="w31" type="number" readonly placeholder="ìë™ ê³„ì‚°">
          <span class="hint">â€» êµ´ì°©/ë¶€ì§€ ì¡°ê±´ì— ë”°ë¼ ìë™ ì‚°ì •</span>
        </div>
      </div>
    </div>

    <!-- êµ´ì°©ê¹Šì´ -->
    <div class="row" id="rowW24">
      <div class="label">êµ´ì°©ê¹Šì´ h1(m)</div>
      <div>
        <div class="field">
          <input id="w24" type="number" placeholder="ì˜ˆ: 3.0" inputmode="decimal" aria-describedby="w24Help">
        </div>
        <div id="w24Help" class="hint">ì˜ˆ: ì§€í‘œë©´ì—ì„œ ê°€ì¥ ê¹Šì€ êµ´ì°© ì €ë©´ê¹Œì§€ì˜ ê¹Šì´(m)</div>
        <div class="err" id="errW26need" aria-live="polite">êµ´ì°©Â·ë‹¨ì°¨ ì…ë ¥ ì‹œ â€˜ë¶€ì§€ë†’ì´ ê´€ê³„â€™ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</div>
      </div>
    </div>

    <!-- ë¶€ì§€ë‹¨ì°¨ -->
    <div class="row" id="rowW25">
      <div class="label">ë¶€ì§€ë‹¨ì°¨ h2(m)</div>
      <div>
        <div class="field">
          <input id="w25" type="number" placeholder="ì˜ˆ: 1.5" inputmode="decimal" aria-describedby="w25Help">
        </div>
        <div id="w25Help" class="hint">ì˜ˆ: í•™êµ ë¶€ì§€ì™€ ê³µì‚¬ë¶€ì§€ ì‚¬ì´ì˜ ë†’ì´ ì°¨ì´(m)</div>
      </div>
    </div>

    <!-- ë¶€ì§€ë†’ì´ ê´€ê³„ -->
    <div class="row" id="rowW26">
      <div class="label">ë¶€ì§€ë†’ì´ ê´€ê³„</div>
      <div>
        <div class="field">
          <select id="w26" aria-describedby="w26Help">
            <option value="">ì„ íƒ</option>
            <option value="ê°™ìŒ">ê°™ìŒ</option>
            <option value="ë‚®ìŒ">ë‚®ìŒ</option>
            <option value="ë†’ìŒ">ë†’ìŒ</option>
          </select>
          <span id="w26Help" class="hint">â€» êµ´ì°©Â·ë‹¨ì°¨ ì…ë ¥ ì‹œ í•„ìˆ˜</span>
        </div>
      </div>
    </div>

    <!-- êµ¬ì¡°ë¬¼ ë†’ì´ -->
    <div class="row">
      <div class="label">êµ¬ì¡°ë¬¼ ë†’ì´(m)</div>
      <div>
        <div class="field">
          <input id="w27" type="number" placeholder="ì˜ˆ: 11.0" inputmode="decimal" aria-describedby="w27Help">
        </div>
        <div id="w27Help" class="hint">ì˜ˆ: ì§€í‘œë©´ë¶€í„° êµ¬ì¡°ë¬¼ ìµœìƒë‹¨ê¹Œì§€ ë†’ì´(m) / *êµ¬ì¡°ë¬¼ : ê±´ì¶•Â·í† ëª©Â·ê°€ì„¤ êµ¬ì¡°ë¬¼</div>
      </div>
    </div>

    <!-- ì¸µìˆ˜ -->
    <div class="row">
      <div class="label">ì¸µìˆ˜</div>
      <div>
        <div class="field">
          <input id="w28" type="number" placeholder="ì˜ˆ: 5" inputmode="numeric" aria-describedby="w28Help">
        </div>
        <div id="w28Help" class="hint">ì˜ˆ: ì§€ìƒì¸µ ê¸°ì¤€ ì¸µìˆ˜(ì§€í•˜ì¸µ ì œì™¸ ë˜ëŠ” ë³„ë„ ê¸°ì¤€ì— ë”°ë¼ ì ìš©)</div>
      </div>
    </div>

    <!-- ê±´ì¶•ë¬¼ ë†’ì´ + ì—ëŸ¬ -->
    <div class="row" id="rowW29">
      <div class="label">ê±´ì¶•ë¬¼ ë†’ì´(m)</div>
      <div>
        <div class="field">
          <input id="w29" type="number" placeholder="ì˜ˆ: 15.0" inputmode="decimal" aria-describedby="w29Help">
        </div>
        <div id="w29Help" class="hint">ì˜ˆ: ì§€í‘œë©´ë¶€í„° ê±´ì¶•ë¬¼ ìµœìƒë‹¨ê¹Œì§€ ë†’ì´(m)</div>
        <div class="err" id="errW29" aria-live="polite">ì¸µìˆ˜ë¥¼ ì…ë ¥í•œ ê²½ìš° ê±´ì¶•ë¬¼ ë†’ì´(m)ë¥¼ í•¨ê»˜ ì…ë ¥í•´ì£¼ì„¸ìš”</div>
      </div>
    </div>

    <!-- ê³µì‚¬ì¢…ë¥˜ -->
    <div class="row">
      <div class="label">ê³µì‚¬ì¢…ë¥˜</div>
      <div>
        <div class="field">
          <select id="w30">
            <option value="">ì„ íƒ</option>
            <option value="í„°ë„ê³µì‚¬">í„°ë„ê³µì‚¬</option>
            <option value="ë°œíŒŒê³µì‚¬">ë°œíŒŒê³µì‚¬</option>
            <option value="ê±´ì¶•ë¬¼ í•´ì²´ê³µì‚¬(í—ˆê°€)">ê±´ì¶•ë¬¼ í•´ì²´ê³µì‚¬(í—ˆê°€)</option>
            <option value="ê±´ì¶•ë¬¼ í•´ì²´ê³µì‚¬(ì‹ ê³ )">ê±´ì¶•ë¬¼ í•´ì²´ê³µì‚¬(ì‹ ê³ )</option>
          </select>
        </div>
      </div>
    </div>

    <div class="notice">í˜„ì¥ë§ˆë‹¤ ìƒì´í•  ìˆ˜ ìˆìœ¼ë‹ˆ ì°¸ê³ ìš©ìœ¼ë¡œë§Œ ì‚¬ìš© ë°”ëë‹ˆë‹¤.</div>

    <div class="field" style="justify-content:flex-end;margin-top:8px">
      <button id="check" class="btn">ê²°ê³¼í™•ì¸</button>
    </div>

    <!-- ê²°ê³¼ì°½ -->
    <div id="result" class="resultbox" role="status" aria-live="polite">
      <div id="resultTitle" class="result-title">
        <span id="resultIcon" class="ico" aria-hidden="true">âœ…</span>
        <span id="resultTitleText"></span>
      </div>
      <div id="resultMsg"></div>
      <div id="nextGuide" class="guide" style="display:none">
        <strong>ğŸ‘‰ë‹¤ìŒ ë‹¨ê³„ ì•ˆë‚´</strong><br>
        â‘  ì„œë¥˜ ì‘ì„± ë° ì œì¶œ Â· â‘¡ ì•ˆì „ì„±í‰ê°€ ê²€í†  Â· â‘¢ ì•ˆì „ì„± ë³´ì™„ ì¡°ì¹˜<br><br>
        ì œì¶œì²˜: êµìœ¡ì‹œì„¤ì˜ ì¥ ë˜ëŠ” ê°ë…ê¸°ê´€ì˜ ì¥<br>
        ì œì¶œì„œë¥˜: êµìœ¡ì‹œì„¤ ì•ˆì „ì„±í‰ê°€ì„œ ë° ê´€ë ¨ ë„ì„œÂ·ë„ë©´ ë“±<br>
        <a href="http://dawonsafety.com/board/board_view?code=estimate&no=16" target="_blank" rel="noopener">ê²¬ì /ë¬¸ì˜ ë°”ë¡œê°€ê¸°</a>
      </div>
    </div>
  </section>
</main>

<script>
(()=>{"use strict";

  /* =========================
     1. í—¬í¼ & ìƒìˆ˜
  ========================== */
  const d = document;
  const $ = sel => d.querySelector(sel);
  const N = v => Number(v) || 0;

  const MSG = {
    NEED_SCOPE : "ìœ„ì¹˜êµ¬ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”",
    NEED_W23   : "ì´ê²©ê±°ë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”",
    NEED_W26   : "êµ´ì°©Â·ë‹¨ì°¨ ì…ë ¥ ì‹œ â€˜ë¶€ì§€ë†’ì´ ê´€ê³„â€™ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”",
    NEED_W29   : "ì¸µìˆ˜ë¥¼ ì…ë ¥í•œ ê²½ìš° ê±´ì¶•ë¬¼ ë†’ì´(m)ë¥¼ í•¨ê»˜ ì…ë ¥í•´ì£¼ì„¸ìš”",

    SCOPE_IN   : "(êµë‚´)ê±´ì¶•í—ˆê°€ ë° ê±´ì¶•ìŠ¹ì¸ì— ë”°ë¥¸ êµìœ¡ì‹œì„¤",
    DIST_4M    : "(êµì™¸)í•™êµê²½ê³„ë¡œë¶€í„° ì§ì„ ê±°ë¦¬ 4ë¯¸í„° ì´ë‚´ì˜ ê±´ì„¤ê³µì‚¬",
    HIGH_BLDG  : "3ì¸µ ì´ìƒ ê±´ì¶•ë¬¼ ë˜ëŠ” êµ¬ì¡°ë¬¼ ë†’ì´ 10ë¯¸í„° ì´ìƒì¸ ê²½ìš°",
    EXCAV      : "êµ´ì°©ê¹Šì´ 2ë¯¸í„° ì´ìƒì¸ ê²½ìš°",
    NOT_TARGET : "ë¹„ëŒ€ìƒ"
  };

  const SPECIAL_WORKS = [
    "í„°ë„ê³µì‚¬",
    "ë°œíŒŒê³µì‚¬",
    "ê±´ì¶•ë¬¼ í•´ì²´ê³µì‚¬(í—ˆê°€)",
    "ê±´ì¶•ë¬¼ í•´ì²´ê³µì‚¬(ì‹ ê³ )"
  ];

  /* =========================
     2. ì˜í–¥ê±°ë¦¬ ê³„ì‚°
  ========================== */
  const calcW31 = ({w24,w25,w26,w27}) => {
    if(w24 >= 2){
      if(w26 === "ê°™ìŒ") return 1.5 * w24 + 4;
      if(w26 === "ë‚®ìŒ") return 1.5 * (w24 + w25) + 4;
      if(w26 === "ë†’ìŒ") return 1.5 * (w24 - w25) + 4;
    }
    return w27 || 0;
  };

  /* =========================
     3. ê°’ ìˆ˜ì§‘
  ========================== */
  const getVals = () => ({
    scope: d.querySelector('input[name="scope"]:checked')?.value || "",
    w23  : N($("#w23").value),
    w24  : N($("#w24").value),
    w25  : N($("#w25").value),
    w26  : $("#w26").value,
    w27  : N($("#w27").value), // êµ¬ì¡°ë¬¼ ë†’ì´
    w28  : N($("#w28").value), // ì¸µìˆ˜
    w29  : N($("#w29").value), // ê±´ì¶•ë¬¼ ë†’ì´
    w30  : $("#w30").value
  });

  /* =========================
     4. ì—ëŸ¬ í‘œì‹œ ìœ í‹¸
  ========================== */
  const showErr = (rowSel, errSel, on) => {
    const row = $(rowSel);
    const err = $(errSel);
    if(!row || !err) return;
    if(on){
      row.classList.add("has-error");
      err.style.display = "block";
    }else{
      row.classList.remove("has-error");
      err.style.display = "none";
    }
  };

  /* =========================
     5. í•„ë“œë³„ ê²€ì¦
  ========================== */
  const validateScope = () => {
    const sel = d.querySelector('input[name="scope"]:checked');
    showErr("#rowScope", "#errScope", !sel);
    return !!sel;
  };

  const validateW23 = () => {
    const scope = d.querySelector('input[name="scope"]:checked')?.value || "";
    // êµë‚´ì¼ ë•ŒëŠ” ì´ê²©ê±°ë¦¬(0 í¬í•¨) í•„ìˆ˜ ì•„ë‹˜
    if(scope === "êµë‚´"){
      showErr("#rowW23", "#errW23", false);
      return true;
    }
    const v = $("#w23").value.trim();
    const invalid = v === "";
    showErr("#rowW23", "#errW23", invalid);
    return !invalid;
  };

  const toggleW26Required = () => {
    const need = !!($("#w24").value) || !!($("#w25").value);
    $("#w26").required = need;
    const ok = $("#w26").value !== "" || !need;
    showErr("#rowW24", "#errW26need", need && !ok);
    return ok;
  };

  const validateW29 = () => {
    const floors  = $("#w28").value.trim();
    const bHeight = $("#w29").value.trim();
    const need = floors !== "";      // ì¸µìˆ˜ ì…ë ¥ ì‹œ ê±´ì¶•ë¬¼ ë†’ì´ í•„ìˆ˜
    const ok   = !need || bHeight !== "";
    showErr("#rowW29", "#errW29", need && !ok);
    return ok;
  };

  /* =========================
     6. íŒì • ë¡œì§
  ========================== */
  const judge = p => {
    const rawW23 = $("#w23").value.trim();

    if(!p.scope && rawW23){
      return {type:"guide", msg:MSG.NEED_SCOPE};
    }
    if(!p.scope){
      return {type:"guide", msg:MSG.NEED_SCOPE};
    }

    // êµë‚´: ì´ê²©ê±°ë¦¬ì™€ ë¬´ê´€í•˜ê²Œ(0 í¬í•¨) ì‘ì„± ëŒ€ìƒ
    if(p.scope === "êµë‚´"){
      return {type:"good", msg:MSG.SCOPE_IN};
    }

    // êµì™¸: ì´ê²©ê±°ë¦¬ í•„ìˆ˜
    if(p.scope === "êµì™¸" && !rawW23){
      return {type:"guide", msg:MSG.NEED_W23};
    }

    // êµì™¸ & 4m ì´ë‚´
    if(p.scope === "êµì™¸" && p.w23 <= 4){
      return {type:"good", msg:MSG.DIST_4M};
    }

    // êµì™¸ & 4m ì´ˆê³¼ ~ 50m ì´ë‚´
    const inRange = (p.scope === "êµì™¸" && p.w23 > 4 && p.w23 <= 50);

    // êµì™¸ & ë²”ìœ„ ë‚´ & ì¸µìˆ˜ â‰¥3 & ê±´ì¶•ë¬¼ ë†’ì´>0 & ì´ê²©ê±°ë¦¬ < ê±´ì¶•ë¬¼ ë†’ì´
    if(inRange && p.w28 >= 3 && p.w29 > 0 && p.w23 < p.w29){
      return {type:"good", msg:MSG.HIGH_BLDG};
    }

    // êµì™¸ & ë²”ìœ„ ë‚´ & êµ¬ì¡°ë¬¼ ë†’ì´ â‰¥10m & ì´ê²©ê±°ë¦¬ < êµ¬ì¡°ë¬¼ ë†’ì´
    if(inRange && p.w27 >= 10 && p.w23 < p.w27){
      return {type:"good", msg:MSG.HIGH_BLDG};
    }

    // êµì™¸ & ë²”ìœ„ ë‚´ & íŠ¹ì • ê³µì‚¬
    if(inRange && SPECIAL_WORKS.includes(p.w30)){
      return {type:"good", msg:p.w30};
    }

    // êµì™¸ & ë²”ìœ„ ë‚´ & êµ´ì°© ì¡°ê±´
    if(inRange && p.w24 > 2){
      const w31 = calcW31(p);
      if(p.w23 < w31){
        return {type:"good", msg:MSG.EXCAV};
      }
    }

    return {type:"bad", msg:MSG.NOT_TARGET};
  };

  /* =========================
     7. ê²°ê³¼ ë Œë”ë§
  ========================== */
  const render = res => {
    const box       = $("#result");
    const title     = $("#resultTitle");
    const titleText = $("#resultTitleText");
    const icon      = $("#resultIcon");
    const msg       = $("#resultMsg");
    const guide     = $("#nextGuide");

    box.style.display = "block";
    msg.textContent   = res.msg;

    if(res.type === "good"){
      box.className = "resultbox";
      title.classList.remove("hidden");
      titleText.textContent = "ì‘ì„± ëŒ€ìƒì…ë‹ˆë‹¤. ì ìš© í•­ëª©:";
      icon.textContent = "âœ…";
      guide.style.display = "block";
    }else if(res.type === "bad"){
      box.className = "resultbox bad";
      title.classList.remove("hidden");
      titleText.textContent = "ì‘ì„± ë¹„ëŒ€ìƒì…ë‹ˆë‹¤.";
      icon.textContent = "âš ï¸";
      guide.style.display = "none";
    }else{ // ì•ˆë‚´ ë¬¸êµ¬ íƒ€ì…
      box.className = "resultbox bad";
      title.classList.add("hidden");
      titleText.textContent = "";
      icon.textContent = "âš ï¸";
      guide.style.display = "none";
    }

    box.scrollIntoView({behavior:"smooth", block:"start"});
  };

  /* =========================
     8. ì´ë²¤íŠ¸ ë°”ì¸ë”©
  ========================== */
  ["blur","input","change"].forEach(ev=>{
    d.addEventListener(ev, e=>{
      const id = e.target?.id;

      if(id === "w23") validateW23();

      if(e.target?.name === "scope"){
        validateScope();
        validateW23();
      }

      if(["w24","w25","w26"].includes(id)) toggleW26Required();

      if(["w28","w29"].includes(id)) validateW29();
    }, true);
  });

  $("#check").addEventListener("click", () => {
    const okScope = validateScope();
    const okW23   = validateW23();
    const okW26   = toggleW26Required();
    const okW29   = validateW29();

    const vals = getVals();
    const w31  = calcW31(vals);
    $("#w31").value = w31 ? Math.round(w31 * 100) / 100 : "";

    if(!okScope || !okW23 || !okW26 || !okW29){
      if(!okScope && $("#w23").value){
        return render({type:"guide", msg:MSG.NEED_SCOPE});
      }
      if(!okW23){
        return render({type:"guide", msg:MSG.NEED_W23});
      }
      if(!okW26){
        return render({type:"guide", msg:MSG.NEED_W26});
      }
      if(!okW29){
        return render({type:"guide", msg:MSG.NEED_W29});
      }
    }

    const res = judge(vals);
    render(res);
  });

})();  
</script>
</body>
</html>
